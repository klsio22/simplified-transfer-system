#!/bin/bash

# Simplified Transfer System - Helper Script
# Comandos √∫teis para desenvolvimento e testes

function ps {
    docker compose ps
}

function up {
    docker compose up -d "${@}"
}

function down {
    docker compose down "${@}"
}

function logs {
    SERVICE="${1:-app}"
    docker compose logs -f "${SERVICE}"
}

function shell {
    docker compose exec app bash
}

function composer {
    docker run --rm --interactive \
        -e COMPOSER_CACHE_DIR="/app/.cache/composer" \
        -u "$(id -u):$(id -g)" -v "$(pwd):/app" \
        -w /app composer:2.7.2 composer "${@}"
}

function test {
    TEST_PATH="${@:-tests/Unit}"
    docker compose exec app ./vendor/bin/phpunit --colors=always "${TEST_PATH}"
}

function test:unit {
    docker compose exec app ./vendor/bin/phpunit --colors=always tests/Unit
}

function test:integration {
    echo "‚ö†Ô∏è  Integration tests require API running!"
    echo "Start with: ./run up"
    echo ""
    docker compose exec app ./vendor/bin/phpunit --colors=always tests/Integration
}

function phpstan {
    docker compose exec app ./vendor/bin/phpstan analyse -c phpstan.neon --memory-limit=512M
}

function cs-fix {
    docker compose exec app ./vendor/bin/php-cs-fixer fix
}

function cs-check {
    docker compose exec app ./vendor/bin/php-cs-fixer fix --dry-run --diff
}

function mysql {
    docker compose exec mysql mysql -u transfer_user -ptransfer_pass -D simplified_transfer
}

function redis {
    docker compose exec redis redis-cli
}


function db:reset {
    echo "üîÑ Resetting database..."
    docker compose exec app php bin/reset-db.php
    if [ $? -eq 0 ]; then
        echo "‚úÖ Database reset complete!"
    else
        echo "‚ùå Database reset failed!"
        return 1
    fi
}

function db:migrate {
    docker compose exec app php bin/migrate.php
}

